<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Run {{ run_id }}</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 24px; }
      .muted { color: #666; font-size: 0.95em; }
      .row { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
      table { border-collapse: collapse; width: 100%; }
      th, td { text-align: left; padding: 8px 10px; border-bottom: 1px solid #eee; vertical-align: top; }
      input[type=text] { padding: 8px; width: 420px; max-width: 100%; }
      select { padding: 8px; }
      code { background: #f6f6f6; padding: 2px 4px; border-radius: 4px; }
      a { color: #0b5fff; text-decoration: none; }
      a:hover { text-decoration: underline; }
      .pager { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; }
      .pill { display: inline-block; padding: 2px 8px; border: 1px solid #ddd; border-radius: 999px; font-size: 0.9em; }
      .pre { white-space: pre-wrap; }
    </style>
  </head>
  <body>
    <div class="row">
      <h1 style="margin:0">Run {{ run_id }}</h1>
      <a href="{{ url_for('index') }}">All runs</a>
    </div>
    <div class="muted">results: <code>{{ results_path }}</code></div>

    <div style="height:16px"></div>

    <form method="get" class="row">
      <label>Search:</label>
      <input type="text" name="q" value="{{ q }}" placeholder="dialogue, summaries, rationale..." />

      <label>judge_pass:</label>
      <select name="judge_pass">
        <option value="" {% if not judge_pass %}selected{% endif %}>any</option>
        <option value="true" {% if judge_pass=='true' %}selected{% endif %}>true</option>
        <option value="false" {% if judge_pass=='false' %}selected{% endif %}>false</option>
      </select>

      <label>page_size:</label>
      <select name="page_size">
        {% for s in [10,25,50,100,200] %}
          <option value="{{ s }}" {% if page_size==s %}selected{% endif %}>{{ s }}</option>
        {% endfor %}
      </select>

      <button type="submit">Apply</button>
      <a href="{{ url_for('run_view', run_id=run_id) }}">Clear</a>
    </form>

    <div style="height:16px"></div>

    <div class="pager">
      <span class="pill">total: {{ total }}</span>
      <span class="pill">page: {{ page }}</span>
      <span class="pill">page_size: {{ page_size }}</span>

      {% set prev_page = page - 1 %}
      {% set next_page = page + 1 %}

      {% if prev_page >= 1 %}
        <a class="pill" href="{{ url_for('run_view', run_id=run_id, q=q, judge_pass=judge_pass, page=prev_page, page_size=page_size) }}">Prev</a>
      {% endif %}
      {% if (page * page_size) < total %}
        <a class="pill" href="{{ url_for('run_view', run_id=run_id, q=q, judge_pass=judge_pass, page=next_page, page_size=page_size) }}">Next</a>
      {% endif %}
    </div>

    <div style="height:16px"></div>

    <table>
      <thead>
        <tr>
          <th>example_id</th>
          <th>judge</th>
          <th>candidate summary</th>
          <th>human judge</th>
        </tr>
      </thead>
      <tbody>
        {% for r in rows %}
        <tr>
          <td>
            <a href="{{ url_for('row_view', run_id=run_id, example_id=r.example_id) }}">{{ r.example_id }}</a>
          </td>
          <td>
            <div><span class="pill">pass: {{ r.judge_pass }}</span></div>
            {% if r.judge_scores %}
              <div class="muted">scores: {{ r.judge_scores }}</div>
            {% endif %}
          </td>
          <td class="pre">{{ (r.candidate_summary or '')[:400] }}{% if (r.candidate_summary or '')|length > 400 %}…{% endif %}</td>
          <td>
            {% if r.human_judge and r.human_judge|length > 0 %}
              <div class="muted">annotated</div>
              <div class="muted">{{ r.human_judge }}</div>
            {% else %}
              <span class="muted">—</span>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>

    {% if rows|length == 0 %}
      <p class="muted">No rows match your filters.</p>
    {% endif %}
  </body>
</html>
