<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>{{ run_id }} / {{ example_id }}</title>
    <style>
      body { font-family: system-ui, -apple-system, Segoe UI, Roboto, sans-serif; margin: 24px; }
      .muted { color: #666; font-size: 0.95em; }
      .row { display: flex; gap: 12px; align-items: center; flex-wrap: wrap; }
      .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
      .card { border: 1px solid #eee; border-radius: 10px; padding: 14px; }
      .card h2 { margin: 0 0 10px 0; font-size: 1.05em; }
      .pre { white-space: pre-wrap; }
      textarea { width: 100%; min-height: 70px; padding: 8px; }
      select { padding: 6px; }
      button { padding: 8px 12px; }
      code { background: #f6f6f6; padding: 2px 4px; border-radius: 4px; }
      a { color: #0b5fff; text-decoration: none; }
      a:hover { text-decoration: underline; }
      .dim { border-top: 1px solid #eee; padding-top: 12px; margin-top: 12px; }
      .dim:first-child { border-top: 0; padding-top: 0; margin-top: 0; }
    </style>
  </head>
  <body>
    <div class="row">
      <h1 style="margin:0">{{ run_id }} / {{ example_id }}</h1>
      <a href="{{ url_for('run_view', run_id=run_id) }}">Back to run</a>
    </div>

    <div style="height:16px"></div>

    <div class="grid">
      <div class="card">
        <h2>Example</h2>
        <div class="muted">example_id: <code>{{ row.example.example_id }}</code></div>
        <div style="height:10px"></div>
        <div class="muted">Dialogue</div>
        <div class="pre">{{ row.example.dialogue }}</div>
        <div style="height:10px"></div>
        <div class="muted">Reference summary</div>
        <div class="pre">{{ row.example.reference_summary }}</div>
      </div>

      <div class="card">
        <h2>Candidate</h2>
        <div class="muted">model: <code>{{ row.candidate.model }}</code></div>
        <div class="muted">prompt_version: <code>{{ row.candidate.prompt_version }}</code></div>
        <div style="height:10px"></div>
        <div class="muted">Summary</div>
        <div class="pre">{{ row.candidate.summary }}</div>

        <div style="height:14px"></div>
        <h2>Judge output</h2>
        <div class="muted">pass: <code>{{ judge_display.pass }}</code></div>
        <div class="muted">scores: <code>{{ judge_display.scores }}</code></div>
        <div style="height:10px"></div>
        <div class="muted">rationale</div>
        <div class="pre">{{ judge_display.rationale }}</div>
      </div>
    </div>

    <div style="height:16px"></div>

    <div class="card">
      <h2>Human judge annotations (written to results.jsonl)</h2>
      <form method="post" action="{{ url_for('annotate', run_id=run_id, example_id=example_id) }}">
        {% for dim in dimensions %}
          {% set ann = ann_by_dim[dim] %}
          <div class="dim">
            <div class="row">
              <strong>{{ dim }}</strong>
              <label>score</label>
              <select name="{{ dim }}_score">
                <option value="" {% if not ann.score %}selected{% endif %}></option>
                {% for s in [1,2,3,4,5] %}
                  <option value="{{ s }}" {% if ann.score==s %}selected{% endif %}>{{ s }}</option>
                {% endfor %}
              </select>
            </div>
            <div style="height:8px"></div>
            <label class="muted">rationale</label>
            <textarea name="{{ dim }}_rationale">{{ ann.rationale or '' }}</textarea>
          </div>
        {% endfor %}
        <div style="height:12px"></div>
        <button type="submit">Save annotations</button>
      </form>
    </div>

    <div style="height:16px"></div>

    <details>
      <summary class="muted">Raw row JSON</summary>
      <pre class="pre">{{ row | tojson(indent=2) }}</pre>
    </details>
  </body>
</html>
